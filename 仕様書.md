# 放課後等デイサービス 業務管理フォーム（日報） 仕様書

## 1. アプリケーション概要
放課後等デイサービスのスタッフが、日々の業務内容、担当した児童の様子、送迎実績を効率的に記録・報告するための業務管理アプリケーション。
**開発フレームワークとして Python の Streamlit を採用し、迅速な開発とインタラクティブなUIを実現する。**

## 2. ユーザー
- 放課後等デイサービス 勤務スタッフ

## 3. 技術スタック
- **Frontend / Backend**: Python, Streamlit
- **Deployment**: Streamlit Community Cloud / ローカルサーバー / Docker (想定)
- **Database**: (未定: CSV/Excel, SQLite, Supabase, Google Sheets等)

## 4. フォーム構成要素

### 4.1. 基本情報
サイドバー (`st.sidebar`) またはトップ配置推奨

| 項目名 | Streamlitコンポーネント | 必須 | 備考 |
| --- | --- | :---: | --- |
| **業務日** | `st.date_input` | ○ | 初期値は `datetime.date.today()` |
| **記入スタッフ名** | `st.selectbox` / `st.session_state` | ○ | ログイン機能実装時は自動取得 |
| **勤務時間** | `st.slider` (時間範囲) / `st.time_input` | | 始業・終業時間 |

### 4.2. 担当児童記録（連絡帳作成用データ）
`st.form` または Expander を利用して区画整理を行う。
複数名担当に対応するため、タブ (`st.tabs`) や入力欄の動的追加ボタンを活用する。

| 項目名 | Streamlitコンポーネント | 必須 | 備考 |
| --- | --- | :---: | --- |
| **担当利用者名** | `st.selectbox` | ○ | 検索可能なドロップダウン |
| **バイタル：体温** | `st.number_input` | ○ | step=0.1, format="%.1f" |
| **バイタル：その他** | `st.text_input` | | 血圧、脈拍、SPO2等 |
| **気分・顔色** | `st.radio` / `st.pills` | | 良/普/悪 (選択肢を見やすく配置) |
| **学習内容** | `st.multiselect` + `st.text_area` | ○ | 定型タグ選択＋自由記述 |
| **自由遊び** | `st.multiselect` + `st.text_area` | ○ | 定型タグ選択＋自由記述 |
| **集団遊び** | `st.multiselect` + `st.text_area` | ○ | 定型タグ選択＋自由記述 |
| **食事・おやつ** | `st.radio` + `st.text_input` | | 完食/残食あり、メニュー |
| **水分補給** | `st.number_input` | | ml単位 |
| **排泄記録** | `st.text_input` | | |
| **特記事項** | `st.text_area` | ○ | **AI文章作成アシスト**機能あり |

### 4.3. 送迎業務記録
送迎担当者のみ入力するため、`st.checkbox` ("送迎業務あり") で表示/非表示を切り替えるか、`st.expander`を利用する。

| 項目名 | Streamlitコンポーネント | 必須 | 備考 |
| --- | --- | :---: | --- |
| **送迎区分** | `st.radio` (horizontal=True) | | 迎え / 送り / 両方 |
| **使用車両** | `st.selectbox` | | |
| **送迎した児童名** | `st.multiselect` | ○ | **利用者マスタ**より選択 (max=6) |

### 4.4. 業務報告・共有事項
| 項目名 | Streamlitコンポーネント | 必須 | 備考 |
| --- | --- | :---: | --- |
| **ヒヤリハット・事故** | `st.toggle` + `st.text_area` | | ONの場合に入力欄表示 |
| **申し送り事項** | `st.text_area` | | |
| **備品購入・要望** | `st.text_input` | | |

### 4.5. 設定・利用者マスタ管理
サイドバーのメニュー切り替え、または別タブにて提供する管理機能。

| 機能名 | Streamlitコンポーネント | 概要 |
| --- | --- | --- |
| **利用者一覧表示** | `st.dataframe` / `st.data_editor` | 現在登録されている利用者を表示・編集 |
| **新規追加** | `st.text_input` + `st.button` | 新しい利用者名をマスタに追加 |
| **削除・無効化** | `st.multiselect` + `st.button` | 選択した利用者を削除（または非表示化） |

## 5. 機能要件

### 5.1. データ管理 (New)
- **利用者マスタ**: JSONまたはCSVファイル等で利用者リストを永続化し、アプリ起動時に読み込む。
- **動的反映**: マスタ管理画面での追加・削除は、日報入力画面の選択肢(`st.selectbox`, `st.multiselect`)に即座に反映させる。

### 5.2. 入力補助機能
- **利用者名検索**: `st.selectbox` の標準検索機能を利用。
- **入力負荷軽減**: `st.multiselect` によるタグ選択を多用し、手入力を減らす。
- **フォームリセット**: 送信完了後に `st.balloons()` などのエフェクトと共にフォームをクリアする (`st.form` の `clear_on_submit=True` 等)。

### 5.3. データ検証 (Validation)
- **体温**: `st.number_input` の `min_value=34.0`, `max_value=42.0` 引数で制限。
- **送迎人数**: `st.multiselect` の `max_selections` 引数で制御。
- **必須チェック**: `st.form_submit_button` 押下時に必須項目の未入力をチェックし、`st.error` で通知。

### 5.4. 出力・連携
- **データ保存**: 送信ボタン押下時にCSVファイル、Excelファイル、またはデータベースへ追記保存。
- **連絡帳プレビュー**: 入力内容を元に整形したテキストを `st.code` や `st.markdown` でプレビュー表示し、コピー＆ペーストしやすくする。

### 5.5. AI文章生成アシスト
特記事項や報告文章の作成をサポートする機能。

- **使用モデル**: `grok-4-1-fast-reasoning` (API連携)
- **機能フロー**:
    1. ユーザーが箇条書きやキーワードを入力（例：「機嫌よし、給食完食、公園で鬼ごっこ」）。
    2. 「AIで文章生成」ボタンを押下。
    3. AIが自然な日報形式の文章を生成し、プレビュー表示。
    4. ユーザーが確認・修正の上、入力欄に反映。
- **設定**: APIキーは環境変数または設定画面（セキュア入力）で管理。

## 6. UI/UX デザイン方針 (Streamlit準拠)
- **モバイル対応**: Streamlitのレスポンシブデザインを活かし、スマホでも操作しやすいコンポーネント配置（縦並び基本）。
- **サイドバー活用**: 日付やログインユーザーなどの共通設定はサイドバーに配置し、メインエリアの入力を妨げない。
- **状態フィードバック**: 送信成功時の `st.success`、エラー時の `st.error` など、明確なフィードバックを表示。
